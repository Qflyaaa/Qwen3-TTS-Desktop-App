# Qwen3-TTS 桌面应用项目说明

## 项目概述

这是一个基于 Tkinter 的 Qwen3-TTS 语音合成桌面应用，提供了友好的图形界面来使用 Qwen3-TTS 的各项功能。

## 项目结构

```
TTS_Desktop_App/
├── app.py                          # 主程序入口
├── run.bat                         # Windows启动脚本
├── requirements.txt                # 依赖包列表
├── README.md                       # 项目说明文档
│
├── config/                         # 配置模块
│   ├── __init__.py
│   ├── constants.py               # 常量定义
│   └── settings.py                # 配置管理
│
├── core/                           # 核心功能模块
│   ├── __init__.py
│   ├── model_loader.py            # 模型加载器（单例模式）
│   ├── voice_clone_manager.py     # 语音克隆管理器
│   ├── voice_generator.py         # 语音生成器
│   └── voice_designer.py          # 音色设计师
│
├── ui/                             # UI界面模块
│   ├── __init__.py
│   ├── main_window.py             # 主窗口
│   ├── tabs/                       # 标签页
│   │   ├── __init__.py
│   │   ├── clone_tab.py           # 语音克隆标签页
│   │   ├── generate_tab.py       # 文本朗读标签页
│   │   ├── design_tab.py          # 音色设计标签页
│   │   └── manage_tab.py          # 文件管理标签页
│   ├── widgets/                    # UI组件
│   │   ├── __init__.py
│   │   └── progress_bar.py        # 进度条组件
│   └── dialogs/                    # 对话框
│       └── __init__.py
│
├── utils/                          # 工具模块
│   ├── __init__.py
│   ├── logger.py                  # 日志系统
│   ├── file_manager.py            # 文件管理工具
│   ├── audio_utils.py             # 音频处理工具
│   └── text_utils.py              # 文本处理工具
│
└── data/                           # 数据目录
    ├── voices/                     # 音色特征文件（.pt）
    ├── audios/                     # 参考音频文件
    ├── texts/                      # 文本文件
    ├── outputs/                    # 生成的音频文件
    └── logs/                       # 日志文件
```

## 核心功能

### 1. 语音克隆并保存音色特征
- **位置**: `core/voice_clone_manager.py`
- **功能**: 从参考音频提取音色特征并保存
- **UI**: `ui/tabs/clone_tab.py`
- **特点**:
  - 支持完整模式和X-Vector模式
  - 自动保存元数据
  - 进度显示

### 2. 加载音色特征并朗读文本
- **位置**: `core/voice_generator.py`
- **功能**: 使用保存的音色特征生成语音
- **UI**: `ui/tabs/generate_tab.py`
- **特点**:
  - 支持语气控制
  - 支持批量处理
  - 自动命名输出文件

### 3. 定制音色并朗读文本
- **位置**: `core/voice_designer.py`
- **功能**: 使用音色设计模型生成指定风格的语音
- **UI**: `ui/tabs/design_tab.py`
- **特点**:
  - 自然语言描述音色
  - 无需参考音频

### 4. 文件管理
- **位置**: `utils/file_manager.py`
- **功能**: 管理音色库、生成历史、统计信息
- **UI**: `ui/tabs/manage_tab.py`
- **特点**:
  - 音色库管理
  - 生成历史查看
  - 统计信息显示

## 技术特点

### 1. 模型加载器（单例模式）
- 避免重复加载模型
- 自动检测GPU/CPU
- 自动检测FlashAttention
- 支持模型卸载释放内存

### 2. 异步处理
- 使用 threading 避免UI阻塞
- 进度回调机制
- 错误处理

### 3. 文件管理
- 规范化目录结构
- 元数据管理（JSON格式）
- 使用统计追踪

### 4. 日志系统
- 按日期分割日志文件
- 多级别日志记录
- 控制台和文件双重输出

## 使用说明

### 启动应用

**方法1**: 直接运行
```bash
python app.py
```

**方法2**: 使用启动脚本（Windows）
```bash
run.bat
```

### 基本使用流程

1. **语音克隆**
   - 选择参考音频文件
   - 输入参考文本
   - 输入音色名称
   - 点击"开始提取特征"

2. **文本朗读**
   - 选择已保存的音色
   - 输入或加载文本
   - （可选）输入语气控制
   - 点击"生成语音"

3. **音色设计**
   - 输入文本
   - 输入音色描述
   - 点击"生成语音"

4. **文件管理**
   - 查看音色库
   - 查看生成历史
   - 查看统计信息

## 配置说明

配置文件位置: `config/app_config.json`（首次运行自动创建）

主要配置项:
- `paths`: 各目录路径
- `models`: 模型路径
- `defaults`: 默认设置（语言、设备等）
- `ui`: UI设置（窗口大小等）

## 注意事项

1. **模型路径**: 确保 Qwen3-TTS 模型已下载到工作空间根目录的 `Qwen3-TTS` 文件夹
2. **GPU支持**: 建议使用 CUDA 版本的 PyTorch 以获得更好的性能
3. **内存管理**: 模型较大，首次加载需要时间，建议至少 8GB 内存
4. **文件格式**: 音频文件建议使用 WAV 格式，文本文件使用 UTF-8 编码

## 依赖包

主要依赖:
- `torch`: PyTorch 深度学习框架
- `soundfile`: 音频文件处理
- `numpy`: 数值计算
- `qwen-tts`: Qwen3-TTS 模型包

可选依赖:
- `flash-attn`: FlashAttention 加速（需要编译）

## 开发说明

### 添加新功能

1. **添加新标签页**:
   - 在 `ui/tabs/` 创建新文件
   - 在 `ui/main_window.py` 中注册

2. **添加新工具**:
   - 在 `utils/` 创建新文件
   - 实现相应功能

3. **修改配置**:
   - 修改 `config/constants.py` 或 `config/settings.py`

### 调试

- 日志文件位置: `data/logs/{日期}.log`
- 查看日志了解运行状态和错误信息

## 已知问题

1. 首次加载模型可能需要较长时间
2. 大文本生成可能需要较长时间
3. 某些音频格式可能需要转换

## 后续改进方向

1. 添加批量处理功能
2. 添加音频预览功能
3. 添加更多预设语气和音色描述
4. 优化UI界面
5. 添加设置对话框
6. 支持更多音频格式

## 许可证

本项目基于 Qwen3-TTS 模型开发。
